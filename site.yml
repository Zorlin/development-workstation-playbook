---
- name: Dev playbook
  hosts: all
  become: true

  vars_files:
    - "vars/dev.yml"

  pre_tasks:
    - name: Print Ansible info useful for development
      debug:
        msg:
          - "{{ ansible_distribution }} {{ ansible_distribution_version }}"

  tasks:
    - name: Install apt repository stuff
      package:
        name:
          - apt-transport-https
          - ca-certificates
          - curl
          - gnupg

    - name: Add the Docker GPG key
      apt_key:
        url: https://download.docker.com/linux/ubuntu/gpg
        state: present

    - name: Add the apt repository for Docker
      apt_repository:
        repo: deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu groovy stable
        state: present
        filename: docker

    - name: Install Docker
      package:
        name:
          - docker-ce
          - docker-ce-cli
          - containerd.io

    - name: Install Docker-compose
      get_url:
        url: https://github.com/docker/compose/releases/download/1.28.5/docker-compose-Linux-x86_64
        dest: /usr/local/bin/docker-compose
        mode: '0755'
        owner: root
        group: root

    - name: Install Ansible Molecule
      pip:
        name: molecule

    - name: Install yamllint and ansible-lint
      package:
        name:
          - yamllint
          - ansible-lint

    - name: Install pre-commit
      pip:
        name: pre-commit

#    - name: Install microk8s
#    - name: Check out my favourite repos
#    - name: Install Steam
#    - name: Install Chia
#    - name: Install Sia

  roles:
    # No roles yet.
